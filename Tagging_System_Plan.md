# 实施计划：单词标签系统

这是一个分步迭代的计划，用于为 WordCard 应用添加单词标签功能。

## 第一阶段：数据模型与基础架构搭建 (Data Model & Infrastructure)

*   **目标**: 建立功能所需的所有数据库表和同步逻辑，为上层 UI 开发打下坚实基础。
*   **状态**: 待办
*   **步骤**:
    1.  **[ ] 修改 `db.ts`**:
        *   定义 `Tag` 和 `WordTag` 两个新的 TypeScript 接口。
        *   创建一个新的数据库版本（`version(7)`），在其中添加 `tags` 和 `word_tags` 两个新表，并为它们设置好索引（例如 `tags: '&id, name'`, `word_tags: '++id, &[wordId+tagId]'`）。
    2.  **[ ] 修改 `sync.ts`**:
        *   在 `performSync` (下行同步) 函数中，增加从 Supabase 拉取 `tags` 和 `word_tags` 表的逻辑，并将数据写入本地。
        *   在 `tableNameMap` 中，添加 `tags` 和 `word_tags` 的映射。
    3.  **[ ] 修改 `db.ts` (再次)**:
        *   为 `tags` 和 `word_tags` 表添加完整的 `creating`, `updating`, `deleting` 数据库钩子，确保本地变更能够被加入 `syncQueue`。
    4.  **[ ] 更新 Supabase**:
        *   等待 Roo 提供 SQL 脚本，在 Supabase 云端创建 `tags` 和 `word_tags` 表，并为它们设置好主键、外键和行级安全（RLS）策略。

## 第二阶段：核心 CRUD 功能 (Core CRUD Functionality)

*   **目标**: 实现对标签的创建、读取、更新和删除，以及将标签关联到单词的核心逻辑。
*   **状态**: 待办
*   **步骤**:
    1.  **[ ] 创建“标签管理器”页面**:
        *   在 `settings` 目录下新建一个 `tags` 页面 (`/settings/tags`)。
        *   此页面将显示一个用户所有标签的列表。
        *   提供一个输入框和“创建”按钮，用于创建新标签。
        *   每个标签项旁边提供“重命名”和“删除”按钮。
    2.  **[ ] 创建“编辑单词标签”组件**:
        *   创建一个可复用的 React 组件，名为 `WordTagsEditor`。
        *   该组件接收一个 `wordId` 作为属性。
        *   它会以多选框（Checkboxes）或开关（Switches）的形式，列出用户的所有标签。
        *   根据传入的 `wordId`，自动勾选该单词已经拥有的标签。
        *   当用户修改勾选状态时，组件会自动在 `word_tags` 表中创建或删除关联记录。
    3.  **[ ] 集成到“词库”页面**:
        *   在“词库”页面 (`/library`) 的每个单词项的“...”菜单中，添加一个“编辑标签”的选项。
        *   点击后，通过一个对话框（Dialog）或弹出层（Sheet）来显示 `WordTagsEditor` 组件。

## 第三阶段：功能整合与体验优化 (Integration & UX Polish)

*   **目标**: 将标签功能与应用的其他部分深度整合，并优化用户体验。
*   **状态**: 待办
*   **步骤**:
    1.  **[ ] 在单词列表中显示标签**:
        *   修改“词库”页面的 `WordList` 组件，在每个单词的下方，以小徽章（Badges）的形式显示其拥有的所有标签。
    2.  **[ ] 实现按标签筛选学习**:
        *   在首页 (`/`) 的 `FlashcardPlayer` 组件上方，添加一个“筛选”按钮。
        *   点击后，弹出一个对话框，列出用户的所有标签。
        *   用户可以选择一个或多个标签进行筛选。
        *   修改 `FlashcardPlayer` 获取学习队列的 `useLiveQuery` 查询逻辑，使其能够根据所选标签，只加载包含这些标签的单词。
    .  **[ ] 在“添加/编辑”页面集成**:
        *   将 `WordTagsEditor` 组件添加到“添加/编辑单词”的表单中，允许用户在创建或编辑单词时直接管理其标签。