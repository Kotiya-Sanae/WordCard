# WordCard 应用开发 - 第二阶段规划：云同步与用户系统

## 1. 第一阶段成果总结

我们已成功完成第一阶段的开发，构建了一个功能完备、UI精美、交互流畅的**本地优先的单机版单词卡片应用**。

**核心成果包括：**
- **完整的核心功能**: 实现了学习（SRS算法）、添加、词库管理（增删改查、多选批量操作）、统计和设置等所有核心模块。
- **现代化的UI/UX**: 构建了适应移动端的响应式布局，支持亮/暗主题切换，并拥有Toast通知、对话框等现代UI组件。
- **健壮的本地数据层**: 使用 Dexie.js 建立了客户端数据库，并成功完成了数据模型的演进和迁移。

目前，应用已经是一个出色的个人学习工具。

---

## 2. 第二阶段目标：从单机到云端

第二阶段的核心目标是将 WordCard 从一个数据孤立的单机应用，升级为一个真正的**多设备、云同步的网络服务**。我们将引入 Supabase 作为后端，实现用户系统和数据同步。

---

## 3. 第二阶段开发任务分解

### 任务一：用户认证系统

这是连接云端的第一步。我们将为应用添加完整的用户注册和登录功能。

- **子任务 1.1：创建认证页面 UI**
  - [ ] 创建 `/auth/login` 页面，包含邮箱、密码输入框和登录按钮。
  - [ ] 创建 `/auth/signup` 页面，包含邮箱、密码输入框和注册按钮。
  - [ ] （可选）创建 `/auth/forgot-password` 页面。

- **子任务 1.2：集成 Supabase Auth**
  - [ ] 在 `lib` 目录下创建 Supabase 客户端实例，使用 `@supabase/ssr` 包。
  - [ ] 实现 `Login` 页面的登录逻辑，调用 Supabase 的 `signInWithPassword` 方法。
  - [ ] 实现 `Signup` 页面的注册逻辑，调用 `signUp` 方法，并处理邮件确认流程。

- **子任务 1.3：会话管理与状态同步**
  - [ ] 创建一个全局的 `UserProvider` 或使用 Zustand store 来管理当前用户的会话状态。
  - [ ] 实现登录后跳转到主页，登出后跳转到登录页的逻辑。
  - [ ] 在 `Header` 或 `Settings` 页面显示当前用户的登录状态和登出按钮。

### 任务二：数据库行级安全 (RLS) - 安全核心

这是保障用户数据隐私和安全**最关键**的一步。

- **子任务 2.1：为数据表添加 `user_id`**
  - [ ] 确保 Supabase 后台的 `word_libraries`, `words`, `study_records`, `settings` 等所有需要用户隔离的表，都包含一个 `user_id` 字段，并与 `auth.users` 表的 `id` 关联。

- **子任务 2.2：编写并启用 RLS 策略**
  - [ ] 为每一张表编写 SQL 安全策略。
  - [ ] **SELECT 策略**: `(auth.uid() = user_id)` - 用户只能读取自己的数据。
  - [ ] **INSERT 策略**: `(auth.uid() = user_id)` - 用户只能为自己创建数据。
  - [ ] **UPDATE 策略**: `(auth.uid() = user_id)` - 用户只能更新自己的数据。
  - [ ] **DELETE 策略**: `(auth.uid() = user_id)` - 用户只能删除自己的数据。
  - [ ] 在 Supabase Dashboard 中为所有表启用 RLS。

### 任务三：数据同步服务

这是实现本地优先架构的最后一块拼图。

- **子任务 3.1：首次数据拉取**
  - [ ] 实现用户首次登录或在空设备上登录后，从 Supabase 后端拉取其所有数据（单词、学习记录等），并写入本地 Dexie.js 数据库的逻辑。

- **子任务 3.2：上行同步（本地 -> 云端）**
  - [ ] 改造所有本地的写操作（`add`, `update`, `delete`）。
  - [ ] 在完成本地 Dexie.js 操作后，异步地调用对应的 Supabase API，将相同的变更应用到云端数据库。
  - [ ] 需要考虑离线情况：如果操作时设备离线，应将变更暂存到一个“待同步队列”中，在网络恢复后再次尝试同步。

- **子任务 3.3：下行同步（云端 -> 本地）(可选，高级功能)**
  - [ ] 使用 Supabase 的实时订阅功能 (`realtime-js`)。
  - [ ] 监听云端数据表的变化。
  - [ ] 当接收到来自其他设备的变更时，将这些变更应用到本地 Dexie.js 数据库，实现多设备间的无缝、即时同步。